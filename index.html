<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CRMonX Luxury App</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              gold: '#D4AF37',
              'gold-light': '#F9F1D8',
              cream: '#FFFAF0',
              black: '#0a0a0a',
              charcoal: '#222222',
              gray: {
                50: '#F9FAFB',
                100: '#F3F4F6',
                200: '#E5E7EB',
                300: '#D1D5DB',
                400: '#9CA3AF',
                500: '#6B7280',
              }
            },
            fontFamily: {
              sans: ['Manrope', 'sans-serif'],
              display: ['Antonio', 'sans-serif'],
            },
            boxShadow: {
              'soft': '0 10px 40px -10px rgba(0, 0, 0, 0.08)',
              'glow': '0 0 20px rgba(212, 175, 55, 0.4)',
              'floating': '0 20px 60px rgba(0,0,0,0.15)',
            }
          }
        }
      }
    </script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&family=Antonio:wght@100;200;300;400;500;600&display=swap" rel="stylesheet">

    <!-- Import Map for React & Lucide -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #FFFAF0;
            color: #222; 
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slideUp { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes drawLine { from { stroke-dashoffset: 1000; } to { stroke-dashoffset: 0; } }
        .animate-draw { stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: drawLine 2.5s ease-out forwards; }

        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
        }
        .animate-pulse-gold { animation: pulse-gold 2s infinite; }

        @keyframes typing {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
            100% { transform: translateY(0px); }
        }
        .typing-dot { animation: typing 1s infinite ease-in-out; }
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Safe Areas */
        .safe-area-top { padding-top: env(safe-area-inset-top); }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Users, AlertTriangle, Camera, Heart, Shield, 
          ListChecks, Activity, Save, PhoneCall, CheckCircle, 
          Clock, Menu, X, Plus, Trash2, ChevronDown, ChevronRight,
          ArrowLeft, Grid, User, LogIn, Lock, MessageCircle, Star, Diamond, Briefcase, LayoutDashboard, CalendarCheck, Bot, Send, Sun, CloudRain, CreditCard, Sparkles, Volume2, DollarSign, Map, MapPin
        } from 'lucide-react';

        // --- SES & HAPTÄ°K SÄ°STEMÄ° ---
        const playSound = (type = 'click') => {
          try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            const now = ctx.currentTime;
            
            if (type === 'click') {
              osc.type = 'sine';
              osc.frequency.setValueAtTime(600, now);
              osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
              gain.gain.setValueAtTime(0.1, now);
              gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
              osc.start(now);
              osc.stop(now + 0.1);
            } else if (type === 'success') {
              osc.type = 'triangle';
              osc.frequency.setValueAtTime(440, now);
              osc.frequency.linearRampToValueAtTime(880, now + 0.1);
              gain.gain.setValueAtTime(0.05, now);
              gain.gain.linearRampToValueAtTime(0.001, now + 0.3);
              osc.start(now);
              osc.stop(now + 0.3);
            }
          } catch (e) {}
        };

        const interact = (type = 'click') => {
          if (navigator.vibrate) navigator.vibrate(type === 'success' ? [15, 50, 15] : 10);
          playSound(type);
        };

        // --- SESLÄ° TANITIM (TTS) ---
        const speakIntro = () => {
          if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            
            const text = "Merhaba Sezen ve Orkut! Ben Siyeremoniks. Yapay zeka destekli lÃ¼ks dÃ¼ÄŸÃ¼n operasyon sisteminizim. Sizin iÃ§in her detayÄ± dÃ¼ÅŸÃ¼ndÃ¼m. Hadi, hayalinizdeki dÃ¼ÄŸÃ¼nÃ¼ kusursuz bir operasyona dÃ¶nÃ¼ÅŸtÃ¼relim.";
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'tr-TR';
            utterance.rate = 0.95;
            utterance.pitch = 1.0;
            
            const voices = window.speechSynthesis.getVoices();
            const trVoice = voices.find(v => v.lang.includes('tr'));
            if(trVoice) utterance.voice = trVoice;

            window.speechSynthesis.speak(utterance);
          } else {
            alert("CihazÄ±nÄ±z sesli asistanÄ± desteklemiyor.");
          }
        };

        // --- Veri ---
        const CATEGORIES = [
            { id: 'people', title: 'Ä°nsanlar & Ä°liÅŸkiler', items: ['vip', 'family', 'crisis'] },
            { id: 'planning', title: 'Planlama & Stil', items: ['style', 'day_exp', 'expectations', 'shotlist', 'must_have', 'negatives'] },
            { id: 'operation', title: 'DÃ¼ÄŸÃ¼n GÃ¼nÃ¼', items: ['ops', 'moments', 'final', 'post_ops'] }
        ];

        const SECTIONS = {
          vip: { id: 'vip', title: 'Ã–zel Konuklar', sub: 'VIP & Protokol', icon: Users },
          family: { id: 'family', title: 'Aile Ä°liÅŸkileri', sub: 'Hassas Durumlar', icon: Heart },
          moments: { id: 'moments', title: 'Kritik Anlar', sub: 'AkÄ±ÅŸ & Sahne', icon: Camera },
          shotlist: { id: 'shotlist', title: 'Shotlist', sub: 'Zorunlu Kareler', icon: ListChecks },
          style: { id: 'style', title: 'Konsept & Stil', sub: 'Atmosfer', icon: Diamond },
          must_have: { id: 'must_have', title: 'VazgeÃ§ilmezler', sub: 'Kesin Ä°stekler', icon: Star },
          negatives: { id: 'negatives', title: 'Ä°stenmeyenler', sub: 'KÄ±rmÄ±zÄ± Ã‡izgi', icon: X },
          day_exp: { id: 'day_exp', title: 'GÃ¼nÃ¼n Ruhu', sub: 'Mod & Enerji', icon: Activity },
          expectations: { id: 'expectations', title: 'Beklentiler', sub: 'Genel AkÄ±ÅŸ', icon: Sparkles },
          crisis: { id: 'crisis', title: 'Kriz YÃ¶netimi', sub: 'Yetki Matrisi', icon: Shield },
          ops: { id: 'ops', title: 'Operasyon', sub: 'Zaman Ã‡izelgesi', icon: Clock },
          final: { id: 'final', title: 'Final & Veda', sub: 'KapanÄ±ÅŸ', icon: CheckCircle },
          post_ops: { id: 'post_ops', title: 'Teslimat', sub: 'After Care', icon: Save },
        };

        const DATA_MAP = {
          'family': { list: ["Vefat / Anma Durumu", "BoÅŸanmÄ±ÅŸ Ebeveyn", "Yeniden Evlilik", "Aile Ä°Ã§i Gerginlikler", "KÃ¼slÃ¼k / Mesafe", "SaÄŸlÄ±k Hassasiyeti", "Psikolojik Hassasiyet"], social: ["Dini / KÃ¼ltÃ¼rel Hassasiyetler", "Alkol Servis PolitikasÄ±", "FotoÄŸraf YasaÄŸÄ±"] },
          'moments': { list: ["Gelin HazÄ±rlÄ±k", "Damat HazÄ±rlÄ±k", "Aile ile Ä°lk KarÅŸÄ±laÅŸma", "First Look", "Portre Ã‡ekimi", "Nikah", "GiriÅŸ Show", "Ä°lk Dans", "Pasta Kesimi"], org: ["GiriÅŸ Koreografisi", "Pasta Seremonisi", "SÃ¼rpriz Performans", "KonuÅŸmalar"] },
          'shotlist': { list: ["HazÄ±rlÄ±k DetaylarÄ±", "Gelin & Anne Ã–zel AnÄ±", "Damat & Baba Ã–zel AnÄ±", "First Look Reaksiyonu", "Nikah Ã‡Ä±kÄ±ÅŸ YÃ¼rÃ¼yÃ¼ÅŸÃ¼"], check: ["Highlight (Ã–zet) Kilitlendi", "Negatif Liste OnaylandÄ±"] },
          'must_have': { list: ["Aile Toplu FotoÄŸrafÄ±", "Ebeveyn Ã–zel Kareleri", "Nedime/SaÄŸdÄ±Ã§ EÄŸlence", "Mekan & Dekor DetaylarÄ±", "Drone Ã‡ekimi", "Golden Hour"] },
          'negatives': { list: ["Zorlama Pozlar", "SÃ¼rekli MÃ¼dahale", "KalabalÄ±k Grup Ã‡ekimleri", "DoÄŸal Olmayan IÅŸÄ±k/FlaÅŸ", "Kamera Ä°le GÃ¶z TemasÄ±", "Yapay Mizansenler"] },
          'style': { list: ["Minimalist & Modern", "Sinematik & Duygusal", "YÃ¼ksek Enerji & Party", "Klasik & ZamansÄ±z", "Fashion & Editorial", "Belgesel & DoÄŸal"] },
          'day_exp': { list: ["SÄ±fÄ±r Stres PolitikasÄ±", "Sessiz Ä°letiÅŸim", "Minimum Anons", "Bizi Koruyun (Tampon BÃ¶lge)", "SÃ¼rprizlere AÃ§Ä±ÄŸÄ±z", "AkÄ±ÅŸta Esneklik"] },
          'ops': { list: ["Ekip Gelin Evinde", "Gelin Alma TamamlandÄ±", "Mekan GiriÅŸi YapÄ±ldÄ±", "Gelin HazÄ±rlÄ±k Bitti", "Damat HazÄ±rlÄ±k Bitti", "First Look YapÄ±ldÄ±", "Portre Ã‡ekimi Bitti", "Aile Ã‡ekimi Bitti", "Salon HazÄ±r", "Konuk KarÅŸÄ±lama", "GiriÅŸ MÃ¼ziÄŸi Cue", "Nikah Memuru HazÄ±r"] },
          'final': { list: ["Pasta Kesildi", "Final Shotlist Tamam", "After Party GeÃ§iÅŸi", "Gelin/Damat Ã‡Ä±kÄ±ÅŸÄ±", "KapanÄ±ÅŸ"] },
          'post_ops': { list: ["Ham Veri YedeÄŸi", "Video Kurguya Girdi", "FotoÄŸraf SeÃ§imi", "Teaser Teslimi", "Reel Teslimi", "AlbÃ¼m TasarÄ±m OnayÄ±", "BaskÄ± TeslimatÄ±"] },
          'expectations': { list: ["Bizi yÃ¶nlendirin", "DoÄŸal akÄ±ÅŸ istiyoruz", "Ã‡ok poz istemiyoruz", "Rahat, sakin ilerlesin", "Enerjik, eÄŸlenceli olsun", "Editorial / ÅŸÄ±k dursun"] }
        };

        const BOT_RESPONSES = {
            'default': "Bunu not aldÄ±m. 10X Operasyon ekibine iletiyorum.",
            'kriz': "Kriz durumlarÄ±nda Ã¶nceliÄŸimiz Ã§iftin huzuru. LÃ¼tfen Kriz Matrisi bÃ¶lÃ¼mÃ¼nden yetkili kiÅŸiyi arayÄ±n.",
            'gelin': "Gelin hanÄ±m iÃ§in 'GÃ¼nÃ¼n Ruhu' bÃ¶lÃ¼mÃ¼nde 'SÄ±fÄ±r Stres' modunu aktifleÅŸtirmenizi Ã¶neririm.",
            'fotoÄŸraf': "FotoÄŸraf iÃ§in 'Shotlist' ve 'VazgeÃ§ilmezler' listesini tamamlamanÄ±z Ã§ok Ã¶nemli.",
            'plan': "Planlama %85 oranÄ±nda tamamlandÄ±. Sadece 'Final' bÃ¶lÃ¼mÃ¼nde eksikler var.",
            'merhaba': "Merhaba! Ben CRMonX 10X AsistanÄ±. DÃ¼ÄŸÃ¼n planlamanda sana nasÄ±l yardÄ±mcÄ± olabilirim?"
        };

        // --- BileÅŸenler ---
        
        // Bottom Sheet Component (Added to fix ReferenceError)
        const BottomSheet = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex flex-col justify-end">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onClick={onClose} />
                    <div className="relative bg-[#FFFAF0] rounded-t-[2rem] p-6 shadow-2xl animate-slideUp max-h-[85vh] overflow-y-auto border-t border-gold/20">
                        <div className="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6 opacity-50" />
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="font-display text-2xl text-black">{title}</h3>
                            <button onClick={onClose} className="p-2 bg-gray-100 rounded-full hover:bg-gray-200"><X size={20}/></button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        };

        const CheckboxItem = ({ label, isChecked, note, onToggle, onNoteChange }) => (
          <div className={`group transition-all duration-300 mb-3 ${isChecked ? 'opacity-70 order-last' : 'opacity-100'}`}>
            <div 
              className={`flex items-start p-4 rounded-xl cursor-pointer transition-all border active:scale-[0.98] ${isChecked ? 'bg-gray-50 border-transparent' : 'bg-white border-gray-100 shadow-sm hover:border-gold/30 hover:shadow-soft'}`}
              onClick={() => { onToggle(); interact(isChecked ? 'click' : 'success'); }}
            >
              <div className={`mt-0.5 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 mr-4 transition-all duration-300 ${isChecked ? 'bg-gold border-gold' : 'border-gray-300 bg-transparent'}`}>
                {isChecked && <CheckCircle size={14} className="text-white" />}
              </div>
              <div className="flex-1">
                <span className={`text-sm font-manrope font-medium block leading-relaxed transition-colors ${isChecked ? 'text-gray-400 line-through' : 'text-gray-800'}`}>
                  {label}
                </span>
                {(isChecked || note) && (
                  <div className="mt-3 animate-fadeIn" onClick={(e) => e.stopPropagation()}>
                    <input
                      type="text"
                      placeholder="Not ekle..."
                      value={note || ''}
                      onChange={(e) => onNoteChange(e.target.value)}
                      className="w-full text-xs p-2 bg-transparent border-b border-gray-200 focus:border-gold outline-none text-gray-600 font-light italic"
                    />
                  </div>
                )}
              </div>
            </div>
          </div>
        );

        // Chatbot Component - Updated with Static Icon
        const Chatbot = ({ isOpen, onClose }) => {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef(null);

            useEffect(() => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }), [messages, isTyping]);
            
            // Auto greeting when opened
            useEffect(() => {
                if(isOpen && messages.length === 0) {
                     setMessages([{ id: 1, text: "Merhaba Sezen & Orkut! Ben CRMonX 10X AsistanÄ±. SÃ¼reÃ§le ilgili her ÅŸeyi bana sorabilirsiniz.", sender: 'bot' }]);
                }
            }, [isOpen]);

            const handleSend = () => {
                if (!input.trim()) return;
                const userMsg = { id: Date.now(), text: input, sender: 'user' };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setIsTyping(true);
                interact('click');

                setTimeout(() => {
                    const lowerInput = userMsg.text.toLowerCase();
                    let responseText = BOT_RESPONSES.default;
                    Object.keys(BOT_RESPONSES).forEach(key => { if (lowerInput.includes(key)) responseText = BOT_RESPONSES[key]; });
                    setMessages(prev => [...prev, { id: Date.now() + 1, text: responseText, sender: 'bot' }]);
                    setIsTyping(false);
                    interact('success');
                }, 1500);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-end justify-center pointer-events-none">
                    <div className="absolute inset-0 bg-black/20 backdrop-blur-sm pointer-events-auto" onClick={onClose} />
                    <div className="bg-white w-full h-[85vh] sm:h-[600px] sm:w-[400px] sm:mb-20 sm:rounded-3xl rounded-t-[2rem] shadow-2xl flex flex-col pointer-events-auto animate-slideUp border border-gold/20">
                        <div className="p-5 border-b border-gray-100 flex justify-between items-center bg-cream rounded-t-[2rem]">
                            <div className="flex items-center gap-3">
                                {/* STATIC ICON AVATAR */}
                                <div className="w-10 h-10 bg-black rounded-full flex items-center justify-center text-gold shadow-lg overflow-hidden">
                                     <Bot size={24} />
                                </div>
                                <div>
                                    <h3 className="font-display text-lg font-bold">10X Asistan</h3>
                                    <p className="text-[10px] text-green-600 font-bold flex items-center gap-1"><span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Online</p>
                                </div>
                            </div>
                            <button onClick={onClose} className="p-2 bg-white rounded-full text-gray-400 hover:text-black hover:bg-gray-100"><X size={20}/></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-5 space-y-4 bg-[#FFFAF0]">
                            {messages.map(msg => (
                                <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[80%] p-4 text-sm shadow-sm ${msg.sender === 'user' ? 'bg-black text-white rounded-l-2xl rounded-tr-2xl rounded-br-sm' : 'bg-white text-gray-700 rounded-r-2xl rounded-tl-2xl rounded-bl-sm border border-gray-100'}`}>{msg.text}</div>
                                </div>
                            ))}
                            {isTyping && <div className="flex justify-start"><div className="bg-white p-4 rounded-r-2xl rounded-tl-2xl border border-gray-100 text-xs text-gray-400 italic">Asistan yazÄ±yor...</div></div>}
                            <div ref={messagesEndRef} />
                        </div>
                        <div className="p-4 bg-white border-t border-gray-100 flex gap-2 rounded-b-none sm:rounded-b-3xl">
                            <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSend()} placeholder="Bir ÅŸeyler yaz..." className="flex-1 bg-gray-50 border-none rounded-xl px-4 text-sm focus:ring-2 focus:ring-gold/20 outline-none" />
                            <button onClick={handleSend} className="w-12 h-12 bg-gold text-white rounded-xl flex items-center justify-center hover:bg-[#bfa035] active:scale-95 transition-transform shadow-lg"><Send size={20} /></button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Ana Uygulama ---

        function CeremonixApp() {
          const [currentView, setCurrentView] = useState('intro'); // intro, dashboard, section, profile, contract, venue
          const [userRole, setUserRole] = useState('user');
          const [activeSectionId, setActiveSectionId] = useState(null);
          
          const [showChat, setShowChat] = useState(false);
          const [showPanicModal, setShowPanicModal] = useState(false);
          const [showAddVipSheet, setShowAddVipSheet] = useState(false);
          const [panicReason, setPanicReason] = useState('');
          const [panicNote, setPanicNote] = useState('');
          
          // Data
          const [vipList, setVipList] = useState(() => JSON.parse(localStorage.getItem('crm_vipList')) || []);
          const [checklistState, setChecklistState] = useState(() => JSON.parse(localStorage.getItem('crm_checklist')) || {});
          const [newPerson, setNewPerson] = useState({ name: '', relation: '', note: '', photo: null, tags: [] });

          useEffect(() => { localStorage.setItem('crm_vipList', JSON.stringify(vipList)); }, [vipList]);
          useEffect(() => { localStorage.setItem('crm_checklist', JSON.stringify(checklistState)); }, [checklistState]);

          const toggleCheck = (id, label) => {
            const key = `${id}-${label}`;
            setChecklistState(prev => ({ ...prev, [key]: { ...prev[key], checked: !prev[key]?.checked } }));
          };

          const updateNote = (id, label, note) => {
            const key = `${id}-${label}`;
            setChecklistState(prev => ({ ...prev, [key]: { ...prev[key], note } }));
          };

          const addVip = () => {
            if(!newPerson.name) return;
            setVipList([...vipList, { ...newPerson, id: Date.now() }]);
            setNewPerson({ name: '', relation: '', note: '', photo: null, tags: [] });
            setShowAddVipSheet(false);
            interact('success');
          };

          const calculateProgress = (sectionId) => {
            const opts = DATA_MAP[sectionId];
            if (!opts) return 0;
            let allItems = [];
            Object.values(opts).forEach(list => allItems = [...allItems, ...list]);
            if (allItems.length === 0) return 0;
            let checkedCount = 0;
            allItems.forEach(item => { if (checklistState[`${sectionId}-${item}`]?.checked) checkedCount++; });
            return Math.round((checkedCount / allItems.length) * 100);
          };

          const calculateTotalProgress = () => {
             const allSections = Object.keys(SECTIONS);
             const total = allSections.reduce((acc, curr) => acc + calculateProgress(curr), 0);
             return Math.round(total / allSections.length);
          };

          const goBack = () => { 
              if (currentView === 'contract' || currentView === 'venue') {
                  setCurrentView('profile');
              } else {
                  setCurrentView('dashboard'); 
                  setActiveSectionId(null); 
              }
          };

          // --- Views ---

          const IntroView = () => (
             <div className="flex flex-col items-center justify-center h-full bg-cream p-8 relative overflow-hidden">
                <div className="absolute top-[-10%] right-[-20%] w-[150%] h-[60%] border-[1px] border-gold/10 rounded-full rotate-12" />
                <div className="absolute bottom-[-10%] left-[-20%] w-[150%] h-[60%] border-[1px] border-gold/10 rounded-full -rotate-12" />
                <div className="relative z-10 w-full max-w-sm text-center">
                    <div className="flex justify-center mb-12 relative">
                        <svg className="absolute w-64 h-64 text-gold/20 animate-draw -top-16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="0.3">
                           <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                        </svg>
                        <div className="text-center">
                            <h1 className="font-display text-8xl font-thin text-black mb-2 tracking-tight">CRMonX</h1>
                            <p className="font-manrope text-[10px] uppercase tracking-[0.6em] text-gold font-bold">Smart Wedding OS</p>
                        </div>
                    </div>
                    
                    <div className="bg-white/60 backdrop-blur-md rounded-3xl p-1.5 flex shadow-sm border border-white/50 mb-8">
                        <button onClick={() => { setUserRole('user'); interact(); }} className={`flex-1 py-4 rounded-2xl text-xs font-bold uppercase tracking-widest transition-all ${userRole === 'user' ? 'bg-black text-white shadow-lg' : 'text-gray-400'}`}>Ã‡ift</button>
                        <button onClick={() => { setUserRole('admin'); interact(); }} className={`flex-1 py-4 rounded-2xl text-xs font-bold uppercase tracking-widest transition-all ${userRole === 'admin' ? 'bg-gold text-white shadow-lg' : 'text-gray-400'}`}>YÃ¶netici</button>
                    </div>

                    {/* SESLÄ° TANITIM BUTONU */}
                    <button onClick={() => { interact(); speakIntro(); }} className="mb-4 text-xs font-bold text-gray-400 uppercase tracking-widest flex items-center justify-center gap-2 hover:text-gold transition-colors">
                        <Volume2 size={16} className="animate-pulse" /> Beni TanÄ±t
                    </button>

                    <button onClick={() => { interact('success'); setCurrentView('dashboard'); }} className={`w-full py-5 rounded-2xl text-xs font-bold uppercase tracking-[0.3em] text-white shadow-xl active:scale-[0.98] transition-all flex items-center justify-center gap-3 ${userRole === 'admin' ? 'bg-gold' : 'bg-black'}`}>GiriÅŸ Yap</button>
                </div>
            </div>
          );

          // NEW: Contract & Budget View
          const ContractView = () => (
            <div className="p-6 pb-32 bg-cream min-h-screen animate-fadeIn">
                 <div className="flex justify-between items-center mb-8">
                    <button onClick={() => { interact(); goBack(); }} className="w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:bg-white"><ArrowLeft size={20} className="text-gray-600"/></button>
                    <h2 className="font-display text-2xl">SÃ¶zleÅŸme & BÃ¼tÃ§e</h2>
                    <div className="w-10"></div>
                 </div>

                 <div className="bg-black text-white rounded-3xl p-8 mb-6 shadow-xl relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-6 opacity-20"><DollarSign size={64} /></div>
                    <p className="text-xs text-gray-400 uppercase tracking-widest mb-1">Toplam BÃ¼tÃ§e</p>
                    <h3 className="font-display text-4xl text-gold mb-6">150.000 â‚º</h3>
                    
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <p className="text-[10px] text-gray-400 uppercase tracking-wide">Ã–denen</p>
                            <p className="font-manrope text-lg font-bold text-green-400">75.000 â‚º</p>
                        </div>
                        <div>
                            <p className="text-[10px] text-gray-400 uppercase tracking-wide">Kalan</p>
                            <p className="font-manrope text-lg font-bold text-red-400">75.000 â‚º</p>
                        </div>
                    </div>
                    <div className="w-full bg-gray-800 h-1.5 rounded-full mt-4">
                        <div className="bg-gold h-full rounded-full" style={{width: '50%'}}></div>
                    </div>
                 </div>

                 <div className="bg-white rounded-3xl p-6 border border-gray-100 shadow-sm">
                    <h3 className="font-manrope text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Hizmet DÃ¶kÃ¼mÃ¼</h3>
                    <div className="space-y-4">
                        {[
                            { item: "Organizasyon & Planlama", cost: "50.000 â‚º", status: "TamamlandÄ±" },
                            { item: "FotoÄŸraf & Video (TÃ¼m GÃ¼n)", cost: "40.000 â‚º", status: "Bekliyor" },
                            { item: "Mekan SÃ¼sleme & Dekor", cost: "60.000 â‚º", status: "KÄ±smi" }
                        ].map((row, i) => (
                            <div key={i} className="flex justify-between items-center py-3 border-b border-gray-50 last:border-0">
                                <div>
                                    <p className="text-sm font-bold text-black">{row.item}</p>
                                    <p className="text-xs text-gray-400">{row.status}</p>
                                </div>
                                <p className="text-sm font-medium text-gray-600">{row.cost}</p>
                            </div>
                        ))}
                    </div>
                 </div>
            </div>
          );

          // NEW: Venue Map View
          const VenueView = () => (
             <div className="p-6 pb-32 bg-cream min-h-screen animate-fadeIn">
                 <div className="flex justify-between items-center mb-8">
                    <button onClick={() => { interact(); goBack(); }} className="w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:bg-white"><ArrowLeft size={20} className="text-gray-600"/></button>
                    <h2 className="font-display text-2xl">Mekan Krokisi</h2>
                    <div className="w-10"></div>
                 </div>
                 
                 <div className="bg-white p-4 rounded-3xl shadow-soft border border-gray-100 mb-6 h-64 flex items-center justify-center relative overflow-hidden">
                    {/* Placeholder for Map Image */}
                    <div className="absolute inset-0 bg-gray-50 flex flex-col items-center justify-center text-gray-300">
                        <Map size={48} className="mb-2 opacity-50" />
                        <p className="text-xs font-bold uppercase tracking-widest">Kroki GÃ¶rseli YÃ¼kleniyor</p>
                    </div>
                 </div>

                 <div className="grid grid-cols-2 gap-4 mb-6">
                    <div className="bg-white p-5 rounded-2xl border border-gray-50 shadow-sm text-center">
                        <Users size={24} className="mx-auto text-gold mb-2"/>
                        <h4 className="font-bold text-2xl">250</h4>
                        <p className="text-[10px] text-gray-400 uppercase">Kapasite</p>
                    </div>
                    <div className="bg-white p-5 rounded-2xl border border-gray-50 shadow-sm text-center">
                        <LayoutDashboard size={24} className="mx-auto text-gold mb-2"/>
                        <h4 className="font-bold text-2xl">24</h4>
                        <p className="text-[10px] text-gray-400 uppercase">Masa SayÄ±sÄ±</p>
                    </div>
                 </div>

                 <div className="bg-white rounded-3xl p-6 border border-gray-100 shadow-sm">
                    <h3 className="font-manrope text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Oturma DÃ¼zeni NotlarÄ±</h3>
                    <ul className="text-sm text-gray-600 space-y-3 list-disc pl-4">
                        <li>Gelin ve Damat masasÄ± piste hakim noktada (A1).</li>
                        <li>Aile bÃ¼yÃ¼kleri piste en yakÄ±n yuvarlak masalarda (B1, B2).</li>
                        <li>Orkestra sahne saÄŸ tarafÄ±nda konumlanacak.</li>
                    </ul>
                 </div>
             </div>
          );

          const DashboardView = () => (
            <div className="p-6 pb-32 bg-cream min-h-screen">
                <div className="bg-white rounded-3xl p-6 shadow-soft border border-gold/10 mb-8 relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-4 opacity-10"><CalendarCheck size={80} /></div>
                    <div className="relative z-10">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <p className="text-xs text-gray-400 uppercase tracking-widest font-bold">Kalan SÃ¼re</p>
                                <h2 className="font-display text-4xl text-black mt-1">208 <span className="text-lg text-gold">GÃ¼n</span></h2>
                            </div>
                            <div className="text-right">
                                <p className="text-xs text-gray-400 uppercase tracking-widest font-bold">Hava Durumu</p>
                                <div className="flex items-center justify-end gap-2 mt-1">
                                    <Sun size={20} className="text-gold"/> <span className="font-display text-xl">24Â°</span>
                                </div>
                            </div>
                        </div>
                        <div className="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                            <div className="h-full bg-gradient-to-r from-gold to-yellow-300" style={{ width: `${calculateTotalProgress()}%` }}></div>
                        </div>
                        <p className="text-[10px] text-gray-400 mt-2 text-right font-bold">% {calculateTotalProgress()} HazÄ±r</p>
                    </div>
                </div>

                <div className="space-y-8">
                    {CATEGORIES.map(cat => (
                        <div key={cat.id} className="animate-fadeIn">
                            <h3 className="font-manrope text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 ml-1 flex items-center gap-2">
                                <span className="w-1 h-1 rounded-full bg-gold"></span> {cat.title}
                            </h3>
                            <div className="grid grid-cols-2 gap-3">
                                {cat.items.map(itemId => {
                                    const section = SECTIONS[itemId];
                                    const progress = calculateProgress(itemId);
                                    const isComplete = progress === 100;
                                    
                                    return (
                                        <button 
                                            key={itemId}
                                            onClick={() => { interact(); setActiveSectionId(itemId); setCurrentView('section'); }}
                                            className={`relative bg-white p-5 rounded-3xl text-left border border-transparent hover:border-gold/30 transition-all shadow-soft group overflow-hidden ${isComplete ? 'opacity-70 grayscale' : ''}`}
                                        >
                                            <div className="flex justify-between items-start mb-4">
                                                <div className={`p-2.5 rounded-2xl ${isComplete ? 'bg-gold text-white' : 'bg-gray-50 text-gray-400 group-hover:text-gold group-hover:bg-gold/10'} transition-colors`}>
                                                    <section.icon size={20} strokeWidth={1.5} />
                                                </div>
                                                {isComplete && <div className="bg-green-100 text-green-700 p-1 rounded-full"><CheckCircle size={12}/></div>}
                                            </div>
                                            <h4 className="font-display text-lg text-black leading-tight mb-1">{section.title}</h4>
                                            <p className="font-manrope text-[10px] text-gray-400 uppercase tracking-wider">{section.sub}</p>
                                            <div className="absolute bottom-0 left-0 w-full h-1 bg-gray-100"><div className="h-full bg-gold transition-all duration-1000" style={{ width: `${progress}%` }}></div></div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    ))}
                </div>
            </div>
          );

          const SectionView = () => {
            const section = SECTIONS[activeSectionId];
            const data = DATA_MAP[activeSectionId];
            const progress = calculateProgress(activeSectionId);
            const isTimeline = activeSectionId === 'ops';

            return (
              <div className="bg-white min-h-screen pb-32">
                <div className="sticky top-0 bg-white/95 backdrop-blur-md z-20 border-b border-gray-100 pt-6 pb-4 px-6 safe-area-top shadow-sm">
                    <div className="flex justify-between items-center mb-4">
                        <button onClick={() => { interact(); goBack(); }} className="w-10 h-10 rounded-full border border-gray-100 flex items-center justify-center hover:bg-gray-50"><ArrowLeft size={20} className="text-gray-600"/></button>
                        <span className="font-manrope text-[10px] font-bold text-gold uppercase tracking-widest border border-gold/30 px-3 py-1 rounded-full">%{progress} TamamlandÄ±</span>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="p-3 bg-cream rounded-2xl text-gold"><section.icon size={28} strokeWidth={1} /></div>
                        <div><h2 className="font-display text-3xl text-black">{section.title}</h2><p className="text-xs text-gray-400">{section.sub}</p></div>
                    </div>
                </div>

                <div className="p-6">
                    {/* VIP Logic */}
                    {activeSectionId === 'vip' && (
                        <button onClick={() => setShowAddVipSheet(true)} className="w-full py-4 border border-dashed border-gray-300 rounded-2xl text-gray-400 font-medium flex items-center justify-center gap-2 hover:border-gold hover:text-gold hover:bg-gold/5 transition-all mb-6"><Plus size={18} /> Yeni KiÅŸi Ekle</button>
                    )}

                    {/* Standard List */}
                    <div className="space-y-8 relative">
                        {isTimeline && <div className="absolute left-[19px] top-4 bottom-4 w-0.5 bg-gray-100 z-0"></div>}
                        
                        {data?.list && data.list.map((opt, idx) => (
                           <div key={opt} className={`relative z-10 ${isTimeline ? 'pl-2' : ''}`}>
                                {isTimeline && <div className="absolute left-[-24px] top-4 w-3 h-3 rounded-full bg-white border-2 border-gold shadow-sm z-10"></div>}
                                <CheckboxItem 
                                    key={opt} label={opt} 
                                    isChecked={checklistState[`${activeSectionId}_main-${opt}`]?.checked} 
                                    note={checklistState[`${activeSectionId}_main-${opt}`]?.note} 
                                    onToggle={() => toggleCheck(`${activeSectionId}_main`, opt)} 
                                    onNoteChange={(val) => updateNote(`${activeSectionId}_main`, opt, val)} 
                                />
                           </div>
                        ))}
                        
                        {!isTimeline && ['social', 'org', 'check'].map(subKey => data?.[subKey] && (
                            <div key={subKey}>
                                <h3 className="font-manrope text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 mt-8 border-t border-gray-100 pt-8">
                                    {subKey === 'social' ? 'Sosyal & KÃ¼ltÃ¼rel' : subKey === 'org' ? 'Organizasyon Detay' : 'Onaylar'}
                                </h3>
                                {data[subKey].map(opt => (
                                    <CheckboxItem 
                                        key={opt} label={opt} 
                                        isChecked={checklistState[`${activeSectionId}_${subKey}-${opt}`]?.checked} 
                                        note={checklistState[`${activeSectionId}_${subKey}-${opt}`]?.note}
                                        onToggle={() => toggleCheck(`${activeSectionId}_${subKey}`, opt)}
                                        onNoteChange={(val) => updateNote(`${activeSectionId}_${subKey}`, opt, val)}
                                    />
                                ))}
                            </div>
                        ))}
                    </div>
                </div>
              </div>
            );
          };

          const ProfileView = () => (
            <div className="p-8 pt-20 text-center animate-fadeIn">
                <div className="w-32 h-32 rounded-full border-2 border-gold p-1 mx-auto mb-6 relative">
                    <div className="w-full h-full rounded-full bg-white flex items-center justify-center overflow-hidden">
                        {userRole === 'admin' ? <Briefcase size={40} className="text-gold"/> : <User size={40} className="text-gold"/>}
                    </div>
                </div>
                <h2 className="font-display text-3xl mb-2">{userRole === 'admin' ? 'YÃ¶netici' : 'Sezen & Orkut'}</h2>
                <p className="font-manrope text-xs text-gray-400 uppercase tracking-widest mb-12">24 AÄŸustos 2026</p>
                
                <div className="space-y-4 max-w-xs mx-auto">
                    <button onClick={() => { interact(); setCurrentView('contract'); }} className="w-full py-4 bg-white border border-gray-100 rounded-2xl text-sm font-medium flex justify-between px-6 items-center shadow-soft active:scale-95 transition-transform">SÃ¶zleÅŸme & BÃ¼tÃ§e <ChevronRight size={16} className="text-gray-300"/></button>
                    <button onClick={() => { interact(); setCurrentView('venue'); }} className="w-full py-4 bg-white border border-gray-100 rounded-2xl text-sm font-medium flex justify-between px-6 items-center shadow-soft active:scale-95 transition-transform">Mekan Krokisi <ChevronRight size={16} className="text-gray-300"/></button>
                    <button onClick={() => setCurrentView('intro')} className="w-full py-4 text-red-500 text-xs font-bold uppercase tracking-widest hover:bg-red-50 rounded-2xl transition-colors mt-8">Oturumu Kapat</button>
                </div>
            </div>
          );

          return (
            <div className="h-screen flex flex-col font-sans text-black overflow-hidden bg-cream">
              <main className="flex-1 overflow-y-auto no-scrollbar pb-24">
                {currentView === 'intro' && <IntroView />}
                {currentView === 'dashboard' && <DashboardView />}
                {currentView === 'section' && <SectionView />}
                {currentView === 'profile' && <ProfileView />}
                {currentView === 'contract' && <ContractView />}
                {currentView === 'venue' && <VenueView />}
              </main>

              {/* Bottom Nav */}
              {currentView !== 'intro' && currentView !== 'section' && currentView !== 'contract' && currentView !== 'venue' && (
                <nav className="glass absolute bottom-0 w-full px-8 py-4 pb-8 border-t border-white/50 flex justify-between items-center z-30 safe-area-bottom">
                  <button onClick={() => { interact(); setCurrentView('dashboard'); }} className={`p-2 transition-colors ${currentView === 'dashboard' ? 'text-black' : 'text-gray-300'}`}><LayoutDashboard size={24} /></button>
                  <div className="absolute left-1/2 -translate-x-1/2 -top-6">
                    <button onClick={() => { interact('error'); setShowPanicModal(true); }} className="w-16 h-16 bg-black rounded-full flex items-center justify-center text-white shadow-2xl border-[6px] border-cream active:scale-95 transition-transform"><PhoneCall size={24} className="text-red-500" /></button>
                  </div>
                  <button onClick={() => { interact(); setCurrentView('profile'); }} className={`p-2 transition-colors ${currentView === 'profile' ? 'text-black' : 'text-gray-300'}`}><User size={24} /></button>
                </nav>
              )}

              {/* Chatbot & Modals */}
              {currentView !== 'intro' && (
                <div className="fixed bottom-24 right-4 z-40">
                    <button onClick={() => { interact(); setShowChat(true); }} className="w-14 h-14 bg-gold rounded-full shadow-floating flex items-center justify-center text-white hover:scale-110 transition-transform animate-pulse-gold">
                        {/* STATIC ICON AVATAR - Updated to fix previous issue */}
                         <Bot size={28} />
                    </button>
                </div>
              )}
              <Chatbot isOpen={showChat} onClose={() => setShowChat(false)} />
              
              <BottomSheet isOpen={showAddVipSheet} onClose={() => setShowAddVipSheet(false)} title="Ã–zel Konuk Ekle">
                 <div className="space-y-6 pb-8">
                    <input type="text" placeholder="Ä°sim Soyisim" className="w-full bg-transparent border-b border-gray-200 py-3 text-lg font-display text-black focus:outline-none focus:border-gold" value={newPerson.name} onChange={e => setNewPerson({...newPerson, name: e.target.value})} />
                    <button onClick={addVip} className="w-full bg-black text-white py-4 rounded-xl text-xs font-bold uppercase tracking-widest hover:bg-gold transition-colors">Kaydet</button>
                 </div>
              </BottomSheet>
              
               {showPanicModal && (
                <div className="fixed inset-0 bg-black/90 z-50 flex items-end sm:items-center justify-center p-0 sm:p-6 backdrop-blur-md animate-fadeIn">
                  <div className="bg-cream w-full sm:rounded-[2rem] rounded-t-[2rem] p-8 relative shadow-2xl animate-slideUp border-t border-gold/50">
                    <button onClick={() => setShowPanicModal(false)} className="absolute top-6 right-6 p-2 bg-gray-100 rounded-full text-gray-400 hover:text-black"><X size={20} /></button>
                    <div className="text-center mb-8">
                      <div className="w-16 h-16 bg-red-50 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse"><AlertTriangle size={32} /></div>
                      <h3 className="font-display text-3xl text-black">CRM10X DESTEK</h3>
                      <p className="font-manrope text-xs text-gray-400 uppercase tracking-widest mt-1">Operasyon MasasÄ±na BaÄŸlan</p>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-3 mb-6">
                      {[
                        { label: 'Gelin/Damat DesteÄŸi', icon: Users },
                        { label: 'Teknik ArÄ±za', icon: Activity },
                        { label: 'Acil LCV DesteÄŸi', icon: Shield },
                        { label: 'CRM10X Operasyon', icon: MessageCircle }
                      ].map((item) => (
                        <button
                          key={item.label}
                          onClick={() => { setPanicReason(item.label); interact('click'); }}
                          className={`p-4 border rounded-2xl flex flex-col items-center justify-center gap-2 transition-all ${
                            panicReason === item.label 
                              ? 'bg-black text-white border-black shadow-lg' 
                              : 'bg-white border-gray-100 text-gray-400 hover:border-gray-300'
                          }`}
                        >
                          <item.icon size={24} strokeWidth={1.5} />
                          <span className="text-[10px] font-bold uppercase tracking-wide">{item.label}</span>
                        </button>
                      ))}
                    </div>

                    <button onClick={() => { interact('success'); const message = `ðŸš¨ *CRMonX ACÄ°L DESTEK TALEBÄ°* ðŸš¨%0A%0A*Konu:* ${panicReason || 'Genel Destek'}%0A%0A_LÃ¼tfen CRM10X Operasyon MasasÄ± olarak acil dÃ¶nÃ¼ÅŸ yapÄ±nÄ±z._`; window.location.href = `https://wa.me/905325614593?text=${message}`; setShowPanicModal(false); }} className={`w-full py-5 rounded-2xl text-xs font-bold uppercase tracking-[0.2em] transition-all flex items-center justify-center gap-3 ${panicReason ? 'bg-red-600 text-white shadow-xl shadow-red-200' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`} disabled={!panicReason}><MessageCircle size={18} /> Operasyon MasasÄ±nÄ± Ara</button>
                  </div>
                </div>
              )}
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<CeremonixApp />);
    </script>
</body>
</html>
